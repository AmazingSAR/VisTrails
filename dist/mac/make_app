#!/usr/bin/env sh
# usage: make_app
# Based on the modified script posted on Mac OS X Hints
# http://www.macosxhints.com/article.php?story=20020311215452999
# Creates a disk image (dmg) of VisTrails on Mac OS X from the command line.
#
# The result will be VisTrails folder with the application and examples inside

echo "removing build and dist folders..."
rm -rf dist/ build/
echo "building bundle..."
python setup.py py2app
echo "copying missing xml.etree.cElementTree imports..."
cp /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-dynload/pyexpat.so dist/VisTrails.app/Contents/Resources/lib/python2.5/lib-dynload/
cp /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/lib-dynload/_elementtree.so dist/VisTrails.app/Contents/Resources/lib/python2.5/lib-dynload/
cp -r /Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/xml dist/VisTrails.app/Contents/Resources/lib/python2.5/
echo "copying qt.conf..."
cp Input/qt.conf dist/VisTrails.app/Contents/Resources/
echo "copying plugins..."
cp -r Input/plugins/* dist/Vistrails.app/Contents/MacOS
echo "copying examples folder..."
cp -r Input/examples dist/
echo "copying README file..."
cp Input/README dist/
echo "packing everything inside the VisTrails folder..."
mkdir dist/VisTrails
mv dist/Vistrails.app dist/VisTrails/
mv dist/examples dist/VisTrails/
#uncomment the following lines for itk support
#echo "including itk..."
#python fix_itk_libraries.py ~/src/itk dist/VisTrails/VisTrails.app/Contents
echo "Done. Now use DMG Canvas to create the compressed dmg file"